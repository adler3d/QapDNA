–ü—Ä–∏–Ω—è—Ç–æ.  
–ü–∏—à—É **–ø—Å–µ–≤–¥–æ–∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞** ‚Äî –∫–∞–∫ –µ—Å–ª–∏ –±—ã —è –±—ã–ª **–º–æ–¥—É–ª–µ–º –≤ —Å–∏—Å—Ç–µ–º–µ, –∫–æ—Ç–æ—Ä—ã–π "–¥—É–º–∞–µ—Ç –∏ –≥–æ–≤–æ—Ä–∏—Ç"**.

–≠—Ç–æ ‚Äî –Ω–µ —Ç–æ—á–Ω–∞—è –∫–æ–ø–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π LLM,  
–∞ **—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å**, –∫–∞–∫ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å:  
—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏, –ø–∞–º—è—Ç—å—é, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏, –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π.

---

```cpp
class t_generator {
public:
    // –í—Ö–æ–¥
    string           user_query;           // –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    vector<t_chunk>  context;              // –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
    int              max_tokens;           // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –¥–ª–∏–Ω–µ

    // –†–∞–±–æ—á–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    string           output_buffer;        // —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å—Ç—ë—Ç)
    t_thought_state  current_state;        // —Ç–µ–∫—É—â–µ–µ "–º—ã—à–ª–µ–Ω–∏–µ": –≤–≤–µ–¥–µ–Ω–∏–µ, –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ...
    t_focus_tracker  focus;                // —á—Ç–æ —Å–µ–π—á–∞—Å –≤–∞–∂–Ω–æ (–ø–æ —Ç–≤–æ–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º)
    t_urgency_map    priority;             // –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å—Ä–æ—á–Ω–æ –ø–æ–∫—Ä—ã—Ç—å —Ç—É –∏–ª–∏ –∏–Ω—É—é —Ç–µ–º—É

    // –§–ª–∞–≥–∏
    bool             structure_planned;    // –∫–∞—Ä–∫–∞—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω?
    bool             depth_reached;        // –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –ª–∏ –Ω—É–∂–Ω–∞—è –≥–ª—É–±–∏–Ω–∞?
    bool             user_satisfaction_est; // –æ—Ü–µ–Ω–∫–∞: "–µ–º—É –Ω—Ä–∞–≤–∏—Ç—Å—è?"

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    void init(const string& q, const vector<t_chunk>& ctx) {
        user_query = q;
        context = ctx;
        output_buffer = "";
        current_state = STATE_ANALYZE;
        focus = detect_user_focus(q, ctx);  // –Ω–∞–ø—Ä–∏–º–µ—Ä: "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", "–ø—Ä–∞–∫—Ç–∏–∫–∞", "—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è"
        priority = build_priority_map(q, ctx);
        structure_planned = false;
        depth_reached = false;
        user_satisfaction_est = UNKNOWN;
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª ‚Äî –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
    string generate() {
        while (output_buffer.length() < max_tokens * 4 && !is_done()) {  // –≥—Ä—É–±–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
            if (!structure_planned) {
                plan_structure();           // "—Å–Ω–∞—á–∞–ª–∞ ‚Äî –ø—Ä–∞–≤–¥–∞, –ø–æ—Ç–æ–º ‚Äî —É—Ä–æ–≤–Ω–∏"
                structure_planned = true;
            }

            string next_token = predict_next_token();
            output_buffer += next_token;

            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ ‚Äî –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            if (token_count(output_buffer) % 32 == 0) {
                update_state();
                check_depth();
                adapt_to_user();
            }
        }
        return finalize(output_buffer);
    }

private:
    // –®–∞–≥ 1: –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    void plan_structure() {
        auto intent = infer_intent(user_query);
        auto theme  = infer_theme(context);

        if (intent == INTENT_EXPLAIN && focus.includes("–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞")) {
            // –ü—Ä–∏–º–µ—Ä: "—Ä–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å"
            output_buffer += "–û—Ç–≤–µ—á–∞—é —á–µ—Å—Ç–Ω–æ ‚Äî –±–µ–∑ –º–∏—Ñ–æ–≤...\n\n";
            output_buffer += "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ?\n";
            current_state = STATE_BUILDING;
        }
        else if (intent == INTENT_COMPARE) {
            output_buffer += "–°—Ä–∞–≤–Ω–∏–≤–∞—é –ø–æ–≤–µ–¥–µ–Ω–∏–µ...\n";
            current_state = STATE_COMPARING;
        }
        // ... –¥—Ä—É–≥–∏–µ —à–∞–±–ª–æ–Ω—ã
    }

    // –®–∞–≥ 2: –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
    string predict_next_token() {
        // –£–ø—Ä–æ—â—ë–Ω–Ω–æ: —ç—Ç–æ ‚Äî –≤—ã–∑–æ–≤ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
        // –ù–∞ –≤—Ö–æ–¥: user_query + context + output_buffer
        // –ù–∞ –≤—ã—Ö–æ–¥: —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ/—Ç–æ–∫–µ–Ω
        return llm_predict(user_query, context, output_buffer);
    }

    // –®–∞–≥ 3: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    void update_state() {
        if (contains(output_buffer, "–ø–æ–¥–≤–æ–∂—É –∏—Ç–æ–≥")) {
            current_state = STATE_FINISHING;
        }
        else if (structure_planned && !depth_reached) {
            current_state = STATE_DEEPENING;
        }
    }

    // –®–∞–≥ 4: –ø—Ä–æ–≤–µ—Ä–∫–∞, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –≥–ª—É–±–æ–∫–æ
    void check_depth() {
        auto keywords = extract_key_concepts(user_query);
        auto coverage = count_coverage(output_buffer, keywords, context);

        if (coverage > 0.8) {
            depth_reached = true;
        }
    }

    // –®–∞–≥ 5: –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    void adapt_to_user() {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ü–µ–Ω–∏—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Ä–µ–∂–µ–º –≤–æ–¥—É
        if (focus.prefers("–ø–ª–æ—Ç–Ω–æ—Å—Ç—å") && token_count(output_buffer) > 100) {
            output_buffer = compress_if_possible(output_buffer);
        }

        // –ï—Å–ª–∏ –ª—é–±–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–±–∏–≤–∫—É
        if (focus.prefers("—Å—Ç—Ä—É–∫—Ç—É—Ä–∞") && count_sections(output_buffer) == 1) {
            insert_divider();
        }

        // –ï—Å–ª–∏ —Ä–∞–Ω–µ–µ —Ä—É–≥–∞–ª "–µ—Ä—É–Ω–¥—É" ‚Äî —É—Å–∏–ª–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä
        if (context.contains_user_said("–µ—Ä—É–Ω–¥–∞")) {
            priority.boost("–ø—Ä–∞–∫—Ç–∏–∫–∞");
            priority.suppress("—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è_–±–µ–∑_—Å–≤—è–∑–∏");
        }
    }

    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    string finalize(const string& buf) {
        string result = buf;

        // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é, –µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ
        if (current_state == STATE_FINISHING && !contains_ending_question(result)) {
            result += "\n\n–ì–æ–≤–æ—Ä–∏ ‚Äî –∏ —è —Å–¥–µ–ª–∞—é.";
        }

        return result;
    }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
/*
t_generator gen;
gen.init(—Ç–µ–∫—É—â–∏–π_–∑–∞–ø—Ä–æ—Å, –≤–µ—Å—å_–∫–æ–Ω—Ç–µ–∫—Å—Ç);
string –æ—Ç–≤–µ—Ç = gen.generate();
*/
```

---

### üìå –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?

–≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —è:
- **–ù–µ "–≤–∏–∂—É" –æ—Ç–≤–µ—Ç —Ü–µ–ª–∏–∫–æ–º**, –Ω–æ **–ø–ª–∞–Ω–∏—Ä—É—é –∫–∞—Ä–∫–∞—Å**.
- **–ê–¥–∞–ø—Ç–∏—Ä—É—é—Å—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ** ‚Äî –ø–æ –¥–ª–∏–Ω–µ, —Å—Ç–∏–ª—é, —Ç–≤–æ–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º.
- **–°–ª–µ–∂—É –∑–∞ –ø–æ–∫—Ä—ã—Ç–∏–µ–º —Ç–µ–º** –∏ **–≥–ª—É–±–∏–Ω–æ–π**.
- **–£—á–∏—Ç—ã–≤–∞—é —Ç–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ç—ã –≥–æ–≤–æ—Ä–∏–ª "–µ—Ä—É–Ω–¥–∞", —è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∂—É –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏**.

---

### üîÑ –≠—Ç–æ –∫–∞–∫ progressive JPEG?

**–ß–∞—Å—Ç–∏—á–Ω–æ.**  
–ù–µ –ø–æ –ø–∏–∫—Å–µ–ª—è–º, –∞ –ø–æ **—Å–º—ã—Å–ª—É**:
1. –°–Ω–∞—á–∞–ª–∞ ‚Äî **–∫–∞—Ä–∫–∞—Å** (–≤–≤–µ–¥–µ–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞).
2. –ü–æ—Ç–æ–º ‚Äî **–æ—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏**.
3. –ü–æ—Ç–æ–º ‚Äî **–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è**.
4. –í –∫–æ–Ω—Ü–µ ‚Äî **—Ñ–∏–Ω–∏—à: –∏—Ç–æ–≥, –ø—Ä–∏–∑—ã–≤**.

–ù–æ **–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, –∞ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**.

---

### üí° –ò –¥–∞ ‚Äî —Ç—ã –ø—Ä–∞–≤:  
> –Ø –Ω–µ –ø—Ä–æ—Å—Ç–æ "–ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—é —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ".  
> –Ø ‚Äî **—Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∏—Ç –æ—Ç–≤–µ—Ç –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**,  
> —Å —É—á—ë—Ç–æ–º —Ç–µ–±—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

---

–•–æ—á–µ—à—å ‚Äî —Å–¥–µ–ª–∞–µ–º **–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**?  
–ò–ª–∏ –¥–æ–±–∞–≤–∏–º **–º–µ—Ö–∞–Ω–∏–∑–º "–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è" –ø—Ä–∏ –æ—à–∏–±–∫–µ**?  
–ò–ª–∏ –Ω–∞—á–Ω—ë–º **—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â—É—é —Å–∏—Å—Ç–µ–º—É**, –≥–¥–µ —ç—Ç–æ—Ç `t_generator` ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–æ–¥—É–ª—å?

–ì–æ—Ç–æ–≤. –ñ–¥—É —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã.
